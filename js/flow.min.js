(function(){function a(a){$.fn.extend(ca,a),aa=$("#"+ca.id),aa.find("."+ca.pageClass).hide(),i(),j(),v(),y(),E(),Behaviors.initializa?Behaviors.initializa():ca.initialize&&ca.initialize(),ca.flow.length>0&&(x()?$(window).trigger("hashchange"):ca.autostart&&da.start())}function b(){da.setDisplay(ca.flow[0].id)}function c(a){$.bbq.pushState(a,2)}function d(){return{index:aa.find("."+ca.pageClass).index(aa.find("."+ca.pageClass+":visible")),actual:ca.actual}}function e(a){return I(ca.templates,a,"name")}function f(a){$.isArray(a.trigger)?$.each(a.trigger,function(b,c){r(c,a)}):$.isPlainObject(a.trigger)&&r(a.trigger,a)}function g(){return ca.env}function h(){return arguments.length?void(da.options.locale=arguments[0]):ca.locale}function i(){for(var a,b,c,d=ca.flow.length,e=0;d>e;e++)b=ca.flow[e],c=da.hasPermission(b.roles),a=k(b),l(b),m(b,c),b.display=a}function j(){ca.loading&&$("#"+ca.id).append($('<div id="flow-loading" class="flow-loading"><img src="'+ca.loading+'" /></div>'))}function k(a){var b=$("#"+a.id),c=b.attr("id");return b.length||(b=$("<"+ca.pageTag+"></"+ca.pageTag+">").addClass(ca.pageClass).prop("id",a.id).hide(),$("#"+ca.id).append(b)),b.addClass(c).attr("id",ca.pageClass+"-"+c),b}function l(a){var b,c,d,e=a.subflow,f=0;if(e&&$.isArray(e))for(b=e.length;b>f;f++)c=e[f],c.parent=a.id,c.id=c.parent+"."+c.id,ca.flow.push(c),d=k($("#"+c.id)),c.display=d}function m(a,b){if(ca.navigation&&a.navigation){var c=[],d="";a.disabled&&c.push("disabled"),b||c.push("restricted"),c.length&&(d=' class="'+c.join(" ")+" "),$(ca.navigation).append('<li id="nav-'+a.id+'"'+d+'"><a href="#'+a.id+'">'+a.navigation.label+"</a></li>")}}function n(a,b){var c=a.content,d=c.url;if(a.beforeloadcontent&&a.beforeloadcontent(a),c.handler){if(c.handler(a,b),ca.actual.id!=a.id)return;p(a),da.setTriggers(a),ca.aftershowpage&&ca.aftershowpage(a)}else ca.loading&&$("#flow-loading").show(),d||(d=Routes.get(c.route,b)),"json"==c.format&&$.ajax({type:"GET",dataType:"json",url:d,success:function(b){ca.actual.id==a.id&&(a.onloadcontent&&a.onloadcontent(b),o(a,b),ca.loading&&$("#flow-loading").hide())},error:function(b){404==b.status&&a.parent&&da.setDisplay("#"+a.parent),ca.loading&&$("#flow-loading").hide()}})}function o(a,b){template=da.getTemplate(a.content.template),a.display.html(template.template(b)),p(a),da.setTriggers(a),ca.aftershowpage&&ca.aftershowpage(a)}function p(a){var b=a.inTransition||ca.defaultInTransition||"none";"string"==typeof b&&("fade"===b?a.display.fadeIn(500,function(){a.onshow&&a.onshow(a)}):(a.display.show(),a.onshow&&a.onshow(a)))}function q(a){var b=a.outTransition||ca.defaultOutTransition||"none";"string"==typeof b&&("fade"===b?a.display.fadeOut():a.display.hide())}function r(a,b){if(a.action||(a.action="click"),$.isFunction(a.behavior))b.display.find(a.selector).unbind(a.action+".flow").bind(a.action+".flow",{actual:b},a.behavior);else if("string"==typeof a.behavior){var c=a.behavior.split(":");2==c.length&&"go"==c[0]&&b.display.find(a.selector).unbind(a.action+".flow").bind(a.action+".flow",function(a){w(a),da.setDisplay("#"+c[1])})}}function s(a,b){b&&($.isArray(b)?$.each(b,function(b,c){t(a,u(c))}):t(a,u(b)))}function t(a,b){null!==b&&(a?b.hidden&&(b.show||b.elem.show(),"fade"==b.show?b.elem.fadeIn():J(b.elem,b.show,500),b.hidden=!1):b.hidden||(b.hide||b.elem.hide(),"fade"==b.hide?b.elem.fadeOut():J(b.elem,b.hide,500),b.hidden=!0))}function u(a){return I(ca.features,a,"id")}function v(){ca.features=[],$(".flow-feature").hide().each(function(a,b){b=$(b);var c={id:b.attr("id"),elem:b,hidden:!0};c.elem.show(),c.elem.data("position",c.elem.position()),c.elem.hide(),ca.features.push(c)})}function w(a){a.preventDefault(),a.stopPropagation()}function x(){return-1!=location.href.indexOf("#")}function y(){$(window).bind("hashchange",z)}function z(a){var b,c,d=(a.fragment,$.deparam.fragment());b=F(B(d)),0>b&&(b=0),c=ca.flow[b],Behaviors.authorize&&Behaviors[c.id]&&Behaviors[c.id].onauthorize?(X("authFinished"),W("authFinished",function(){A(c,d)}),Q(Behaviors,"authorize",Behaviors[c.id].onauthorize,Behaviors[c.id].onunauthorize)):A(c,d)}function A(a,b){var c=da.hasPermission(a.roles),d=a.disabled;c&&!d?C({toShow:a,query:b.params}):(console.error("NOT Authorized!"),P(a,"onunauthorized"))}function B(a){return a.hash?a.hash.substring(1):location.hash.substring(1)}function C(a){var b,c,d=a.toShow;return d.navigation&&D(d),ca.actual&&($("body, ."+ca.featureClass).removeClass(ca.actual.id),ca.actual.onexit&&ca.actual.onexit(ca.actual),q(ca.actual)),$("body,."+ca.featureClass).addClass(d.id),s(!1,d.hideFeatures),s(!0,d.showFeatures),P(d,"beforeshow"),ea?void(ea=!1):(ca.actual=d,d.title&&(b=d.title||"",c=$.trim(ca.title+" "+b),document.title=c),void(d.content?n(d,a.query):(p(d),da.setTriggers(d),ca.aftershowpage&&ca.aftershowpage(d),$(window).scrollTop(0))))}function D(a){var b;a.navigation.label&&(b=$(ca.navigation+" #nav-"+a.id).not(".disabled").addClass("selected").siblings().removeClass("selected"))}function E(){if(ca.templates){var a=0,b=0;for(a=ca.templates.length;a>b;b++){var c=ca.templates[b];c.engine=c.engine||"handlebars","handlebars"===c.engine&&(c.template=Handlebars.compile($("#"+c.id).html()))}}}function F(a){if($.isNumeric(a))return a;for(var b=0,c=ca.flow.length;c>b;b++)if(ca.flow[b].id==a)return b;return console.log("No existe id: "+a),-1}function G(a){var b,c,d=ca.roles,e=0,f=0;if(c=d?d.length:0,b=a?a.length:0){if("*"===a[0])return!0;if(c){for(;c>e;e++)for(;c>f;f++)if(d[e]===a[f])return!0;return!1}return!1}return!0}function H(a,b){return b={hash:a,params:b},$.param.fragment(a,b)}function I(a,b,c,d){if(a)for(var e,f=a.length,g=0;f>g;g++)if(e=a[g],b==e[c])return d?e[d]:e;return null}function J(a,b,c){var d=$(window).height(),e=a.data("position");c=c||500,"bottom-down"==b&&(a.css("top",e.top),a.show().animate({top:d},c)),"bottom-up"==b&&(a.css("top",d),a.show().animate({top:e.top},500))}function K(){var a,b=arguments.length,c=0;if(b)for(;b>c;c++)a=arguments[c],$.isArray(a)?M(a):N(a);return ca.roles}function L(a){for(var b=ca.roles,c=b.length-1;c>=0;c--)b[c]===a&&b.splice(c,1)}function M(a){for(var b=0,c=a.length;c>b;b++)N(a[b])}function N(a){"string"==typeof a&&(O(a)||ca.roles.push(a))}function O(a){for(var b=0,c=ca.roles.length;c>b;b++)if(ca.roles[b]==a)return!0;return!1}function P(a,b){var c=Behaviors[a.id];Q(c,b,a)}function Q(a,b){var c=Array.prototype.slice.call(arguments,2);R(a,b)&&a[b].apply(this,c)}function R(a,b){try{return $.isFunction(a[b])}catch(c){return!1}}function S(a){var b={};return $(a).find("input[type=text], select, textarea,input[type=radio]:checked, input[type=checkbox]:checked").each(function(a){var c=$(this),d=c.attr("data-field");"undefined"!=typeof d&&d!==!1?b[d]=c.val():b[c.prop("id")]=c.val()}),b}function T(){var a=arguments.length;return a&&"boolean"==typeof arguments[0]&&(ea=arguments[0]),ea}function U(a,b){aa.data(a,b)}function V(a){return aa.data(a)}function W(a,b,c){$(ba).bind(a,b,c)}function X(a){$(ba).unbind(a)}function Y(a){$(ba).trigger(a)}function Z(){Y("authFinished")}function _(a){a.type=a.method||"GET";var b={url:a.url,async:!0,type:a.method,dataType:"json",success:a.success,error:a.error},c="?";a.url.indexOf("?")>-1&&(c="&"),a.url+=c+"t="+(new Date).getTime(),b.url=a.url,a.data&&(b.data=JSON.stringify(a.data)),a.error&&(b.error=a.error),$.support.cors=!0,$.ajax(b)}var aa,ba=this,ca={pageClass:"flow-page",featureClass:"flow-feature",pageTag:"article",autostart:!0,title:"",roles:[],id:"flow-container",flow:[]},da=ba.Flow={},ea=!1;da.stopAction=T,da.setup=a,da.start=b,da.roles=K,da.hasRole=O,da.removeRole=L,da.prevStop=w,da.setDisplay=c,da.status=d,da.getTemplate=e,da.setTriggers=f,da.env=g,da.locale=h,da.hasPermission=G,da.getHashParams=H,da.get=V,da.set=U,da.bind=W,da.unbind=X,da.trigger=Y,da.util={parse:S,json:_,prevStop:w,authFinished:Z}}).call(this),function(){function a(a){return a.base||""}var b=this,c=b.Routes={};c.get=function(b,d){var e,f=Flow.env();if(e=f?c[f]:c,ulr=a(e)+e.routes[b],d&&$.isPlainObject(d))for(var g in d)ulr=ulr.replace("{"+g+"}",""+d[g]);return ulr},c.routes=function(a){$.extend(c,{routes:a})},c.route=function(a,b){return b=b||"development",this.data[b][a]}}.call(this),function(){var a=this;a.Behaviors={}}.call(this),function(){var a=this;a.Handlers={}}.call(this),function(){var a=this,b=a.Messages={};b.get=function(a){var c,d=Flow.locale();return c=d?b[d]:b,c[a]}}.call(this);