/*! dv-site v0.1.0 2014-02-07 07:01:59 */
!function(a){window.stop=function(a){a.preventDefault(),a.stopPropagation()};var b={init:function(b){function c(){return-1!=location.href.indexOf("#")}var d=a(this),e={pageClass:".page",autostart:!0,title:"",roles:[]};a.fn.extend(e,b),a.data(this[0],"options",e),a(this).find(e.pageClass).hide(),d.flow("initFeatures"),!c()&&e.autostart&&b.mainFlow.length>0?d.flow("start"):c()&&d.flow("setDisplay",location.hash.substring(1)),d.flow("bindHistoryEvents",d),d.flow("initTemplates",e)},bindHistoryEvents:function(b){var b=a(this),c=a.data(this[0],"options");c.enableHashStates&&a(window).bind("hashchange",function(a){var c=a.fragment;b.flow("setDisplay",c)})},initTemplates:function(b){if(b.templates){var c=0,d=0;for(c=b.templates.length;c>d;d++){var e=b.templates[d];e.engine=e.engine||"handlebars","handlebars"===e.engine&&(e.template=Handlebars.compile(a("#"+e.id).html()))}}},initFeatures:function(){var b=(a(this),a.data(this[0],"options")),c=0,d=0;if(b.features)for(a(".flow-feature").hide(),c=b.features.length;c>d;d++){var e=b.features[d];e.elem=a("#"+e.id),e.elem.show(),e.elem.data("position",e.elem.position()),e.elem.hide(),e.hidden=!0}},start:function(){a(this).flow("setDisplay",0)},setDisplay:function(b){function c(c){if(a.isNumeric(b))return b;for(var d=f.mainFlow,e=0,g=d.length;g>e;e++)if(f.mainFlow[e].id==c)return e;return console.log("No existe id: "+c),-1}function d(a){var b,c,d=a.roles,e=f.roles,g=0,h=0;if(c=e?e.length:0,b=d?d.length:0){if("*"===d[0])return!0;if(c){for(;c>g;g++)for(;c>h;h++)if(e[g]===d[h])return!0;return!1}return!1}return!0}var e=a(this),f=a.data(this[0],"options"),g=f.mainFlow[c(b)];if(b=c(b),!(0>b)){if(g.display=a("#"+g.id),f.actual&&(a(".flow-feature").removeClass(f.actual.id),f.actual.onexit&&f.actual.onexit(g),e.flow("hide",f.actual)),g.condition&&!g.condition()&&(g=f.mainFlow[g.alternate]),g.next&&"string"==typeof g.next&&g.display.find(g.next).unbind("click.flow").bind("click.flow",function(a){a.preventDefault(),a.stopPropagation(),e.flow("setDisplay",b+1)}),f.navigation&&f.navigation.length)for(var h,i,j,k=0,l=f.navigation.length;l>k;k++)h=f.navigation[k],d(h)&&!j?(a(h.link).unbind("click.flow").bind("click.flow",{index:h.target},function(b){b.preventDefault(),b.stopPropagation(),a(this).hasClass("selected")||(e.flow("setDisplay",b.data.index),a(this).addClass("selected").siblings().removeClass("selected"))}),(h.target==g.navSelection||h.target==g.id)&&a(h.link).addClass("selected").siblings().removeClass("selected")):j||i.addClass("disabled").removeClass("selected");if(a(".flow-feature").addClass(g.id),e.flow("showFeatures",!1,g.hideFeatures),e.flow("showFeatures",!0,g.showFeatures),e.flow("setTriggers",g),g.beforeshow&&g.beforeshow(g),f.actual=g,f.enableHashStates){{var m="#"+g.id,n=g.history.data||null,n=a.fn.extend(n,{toShow:g.id});g.history.title||g.id,a.trim(f.title)}a.bbq.pushState(m)}return g.content?e.flow("loadContent",g):e.flow("show",g),e}},loadContent:function(b){var c=a(this),d=a.data(this[0],"options"),e=b.content.url;e||(e=routes.route(b.content.route,d.env)),"json"==b.content.format&&a.ajax({type:"GET",dataType:"json",url:e,success:function(a){b.content.handler?(b.content.handler(b,a),c.flow("show",b)):c.flow("fill",b,a)}})},fill:function(b,c){var d=a(this);template=d.flow("getTemplate",b.content.template),b.display.html(template.template(c)),d.flow("show",b)},show:function(b){var c=(a(this),a.data(this[0],"options")),d=b.inTransition||c.defaultInTransition||"none";"string"==typeof d&&("fade"==d?b.display.fadeIn(500,function(){b.onshow&&b.onshow(b)}):(b.display.show(),b.onshow&&b.onshow(b)))},hide:function(b){var c=(a(this),a.data(this[0],"options")),d=b.outTransition||c.defaultOutTransition||"none";"string"==typeof d&&("fade"==d?b.display.fadeOut():b.display.hide())},showFeatures:function(b,c){var d=a(this);c&&(a.isArray(c)?a.each(c,function(a,c){d.flow("showFeature",b,d.flow("getFeature",c))}):d.flow("showFeature",b,d.flow("getFeature",c)))},getFeature:function(b){for(var c,d=(a(this),a.data(this[0],"options")),e=d.features,f=e.length,g=0;f>g;g++)if(c=e[g],b==c.id)return c;return null},getTemplate:function(b){for(var c,d=(a(this),a.data(this[0],"options")),e=d.templates,f=e.length,g=0;f>g;g++)if(c=e[g],b==c.name)return c;return null},showFeature:function(b,c){var d=a(this);b?c.hidden&&(c.show||c.elem.show(),"fade"==c.show?c.elem.fadeIn():d.flow("animate",c.elem,c.show,500),c.hidden=!1):c.hidden||(c.hide||c.elem.hide(),"fade"==c.hide?c.elem.fadeOut():d.flow("animate",c.elem,c.hide,500),c.hidden=!0)},setTriggers:function(b){function c(c){if(c.action||(c.action="click"),a.isFunction(c.behavior))b.display.find(c.selector).unbind(c.action+".flow").bind(c.action+".flow",{actual:b},c.behavior);else if("string"==typeof c.behavior){var e=c.behavior.split(":");2==e.length&&"go"==e[0]&&b.display.find(c.selector).unbind(c.action+".flow").bind(c.action+".flow",function(a){stop(a),d.flow("setDisplay",e[1])})}}var d=a(this);a.isArray(b.trigger)?a.each(b.trigger,function(a,b){c(b)}):a.isPlainObject(b.trigger)&&c(b.trigger)},animate:function(b,c,d){var e=a(window).height(),f=b.data("position");d=d||500,"bottom-down"==c&&(b.css("top",f.top),b.show().animate({top:e},d)),"bottom-up"==c&&(b.css("top",e),b.show().animate({top:f.top},500))},status:function(){var b=(a(this),a.data(this[0],"options"));return{index:a(this).find(".page").index(a(this).find(".page:visible")),actual:b.actual}},onStateChange:function(a){console.log(a,History.getState())},roles:function(){function b(a){for(var b=0,d=a.length;d>b;b++)c(a[b])}function c(a){"string"==typeof a&&(d(a)||h.push(a))}function d(a){for(var b=0,c=h.length;c>b;b++)if(h[b]==a)return!0;return!1}var e,f=a(this),g=f.data("options"),h=g.roles,i=arguments.length,j=0;if(!i)return g.roles;for(;i>j;j++)e=arguments[j],a.isArray(e)?b(e):c(e);g.roles=h}};a.fn.flow=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery.modal"):b.init.apply(this,arguments)}}(jQuery);