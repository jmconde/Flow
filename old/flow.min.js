/*! flow v0.5.0 2014-02-18 11:24:11 */
(function(){function a(a){$.fn.extend(K,a),I=$("#"+K.id),I.find("."+K.pageClass).hide(),i(),u(),x(),C(),K.flow.length>0&&(w()?$(window).trigger("hashchange"):K.autostart&&L.start())}function b(){L.setDisplay(K.flow[0].id)}function c(a){$.bbq.pushState(a,2)}function d(){return{index:I.find("."+K.pageClass).index(I.find("."+K.pageClass+":visible")),actual:K.actual}}function e(a){return G(K.templates,a,"name")}function f(a){$.isArray(a.trigger)?$.each(a.trigger,function(b,c){q(c,a)}):$.isPlainObject(a.trigger)&&q(a.trigger,a)}function g(){return K.env}function h(){return arguments.length?void(L.options.locale=arguments[0]):K.locale}function i(){for(var a,b,c,d=K.flow.length,e=0;d>e;e++)b=K.flow[e],c=L.hasPermission(b.roles),a=j(b),k(b),l(b,c),b.display=a}function j(a){var b=$("#"+a.id);return b.length||(b=$("<"+K.pageTag+"></"+K.pageTag+">").addClass(K.pageClass).prop("id",a.id).hide(),$("#"+K.id).append(b)),b}function k(a){var b,c,d,e=a.subflow,f=0;if(e&&$.isArray(e))for(b=e.length;b>f;f++)c=e[f],c.parent=a.id,c.id=c.parent+"."+c.id,K.flow.push(c),d=j($("#"+c.id)),c.display=d}function l(a,b){if(K.navigation){var c=[],d="";a.disabled&&c.push("disabled"),b||c.push("restricted"),c.length&&(d=' class="'+c.join(" ")+" "),$(K.navigation).append('<li id="nav-'+a.id+'"'+d+'"><a href="#'+a.id+'">'+a.navigation.label+"</a></li>")}}function m(a,b){var c=a.content,d=c.url;if(a.beforeloadcontent&&a.beforeloadcontent(a),c.handler){if(c.handler(a,b),K.actual.id!=a.id)return;o(a),L.setTriggers(a),K.aftershowpage&&K.aftershowpage(a)}else d||(d=Routes.get(c.route,b)),"json"==c.format&&$.ajax({type:"GET",dataType:"json",url:d,success:function(b){K.actual.id==a.id&&(a.onloadcontent&&a.onloadcontent(b),n(a,b))},error:function(b){404==b.status&&a.parent&&(console.log("#"+a.id),L.setDisplay("#"+a.parent))}})}function n(a,b){template=L.getTemplate(a.content.template),a.display.html(template.template(b)),o(a),L.setTriggers(a),K.aftershowpage&&K.aftershowpage(a)}function o(a){var b=a.inTransition||K.defaultInTransition||"none";"string"==typeof b&&("fade"==b?a.display.fadeIn(500,function(){a.onshow&&a.onshow(a)}):(a.display.show(),a.onshow&&a.onshow(a)))}function p(a){var b=a.outTransition||K.defaultOutTransition||"none";"string"==typeof b&&("fade"==b?a.display.fadeOut():a.display.hide())}function q(a,b){if(a.action||(a.action="click"),$.isFunction(a.behavior))b.display.find(a.selector).unbind(a.action+".flow").bind(a.action+".flow",{actual:b},a.behavior);else if("string"==typeof a.behavior){var c=a.behavior.split(":");2==c.length&&"go"==c[0]&&b.display.find(a.selector).unbind(a.action+".flow").bind(a.action+".flow",function(a){v(a),L.setDisplay({index:c[1]})})}}function r(a,b){b&&($.isArray(b)?$.each(b,function(b,c){s(a,t(c))}):s(a,t(b)))}function s(a,b){a?b.hidden&&(b.show||b.elem.show(),"fade"==b.show?b.elem.fadeIn():H(b.elem,b.show,500),b.hidden=!1):b.hidden||(b.hide||b.elem.hide(),"fade"==b.hide?b.elem.fadeOut():H(b.elem,b.hide,500),b.hidden=!0)}function t(a){return G(K.features,a,"id")}function u(){var a=0,b=0;if(K.features)for($(".flow-feature").hide(),a=K.features.length;a>b;b++){var c=K.features[b];c.elem=$("#"+c.id),c.elem.show(),c.elem.data("position",c.elem.position()),c.elem.hide(),c.hidden=!0}}function v(a){a.preventDefault(),a.stopPropagation()}function w(){return-1!=location.href.indexOf("#")}function x(){$(window).bind("hashchange",y)}function y(a){var b,c,d,e=(a.fragment,$.deparam.fragment());b=D(z(e)),c=K.flow[b],d=L.hasPermission(c.roles),isDisabled=c.disabled,d&&!isDisabled?A({toShow:c,query:e.params}):console.error("NOT Authorized!")}function z(a){return a.hash?a.hash.substring(1):location.hash.substring(1)}function A(a){var b,c,d=a.toShow;d.navigation&&B(d),K.actual&&($("."+K.featureClass).removeClass(K.actual.id),K.actual.onexit&&K.actual.onexit(K.actual),p(K.actual)),$("."+K.featureClass).addClass(d.id),r(!1,d.hideFeatures),r(!0,d.showFeatures),d.beforeshow&&d.beforeshow(d),K.actual=d,d.title&&(b=d.title||"",c=$.trim(K.title+" "+b),document.title=c),d.content?m(d,a.query):(o(d),L.setTriggers(d),K.aftershowpage&&K.aftershowpage(d))}function B(a){var b;a.navigation.label&&(b=$(K.navigation+" #nav-"+a.id).not(".disabled").addClass("selected").siblings().removeClass("selected"))}function C(){if(K.templates){var a=0,b=0;for(a=K.templates.length;a>b;b++){var c=K.templates[b];c.engine=c.engine||"handlebars","handlebars"===c.engine&&(c.template=Handlebars.compile($("#"+c.id).html()))}}}function D(a){if($.isNumeric(a))return a;for(var b=0,c=K.flow.length;c>b;b++)if(K.flow[b].id==a)return b;return console.log("No existe id: "+a),-1}function E(a){var b,c,d=K.roles,e=0,f=0;if(c=d?d.length:0,b=a?a.length:0){if("*"===a[0])return!0;if(c){for(;c>e;e++)for(;c>f;f++)if(d[e]===a[f])return!0;return!1}return!1}return!0}function F(a,b){return b={hash:a,params:b},$.param.fragment(a,b)}function G(a,b,c,d){for(var e,f=a.length,g=0;f>g;g++)if(e=a[g],b==e[c])return d?e[d]:e;return null}function H(a,b,c){var d=$(window).height(),e=a.data("position");c=c||500,"bottom-down"==b&&(a.css("top",e.top),a.show().animate({top:d},c)),"bottom-up"==b&&(a.css("top",d),a.show().animate({top:e.top},500))}var I,J=this,K={pageClass:"flow-page",featureClass:"flow-feature",pageTag:"article",autostart:!0,title:"",roles:[],id:"flow-container",flow:[]},L=J.Flow={};L.setup=a,L.start=b,L.prevStop=v,L.setDisplay=c,L.status=d,L.getTemplate=e,L.setTriggers=f,L.env=g,L.locale=h,L.hasPermission=E,L.getHashParams=F}).call(this),function(){function a(a){return a.base||""}var b=this,c=b.Routes={};c.get=function(b,d){var e,f=Flow.env();if(e=f?c[f]:c,ulr=a(e)+e.routes[b],d&&$.isPlainObject(d))for(var g in d)ulr=ulr.replace("{"+g+"}",""+d[g]);return ulr},c.routes=function(a){$.extend(c,{routes:a})},c.route=function(a,b){return b=b||"development",this.data[b][a]}}.call(this),function(){{var a=this;a.Behaviors={}}}.call(this),function(){{var a=this;a.Handlers={}}}.call(this),function(){var a=this,b=a.Messages={};b.get=function(a){var c,d=Flow.locale();return c=d?b[d]:b,c[a]}}.call(this);